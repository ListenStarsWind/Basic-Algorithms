# [basic-calculator-ii](https://leetcode.cn/problems/basic-calculator-ii)

![image-20250308103949890](https://md-wind.oss-cn-nanjing.aliyuncs.com/md/20250308103949985.png)

## overview

基本计算器Ⅰ比基本计算器Ⅱ要难. 有很多细节和概念需要说明, 所以我们之后有机会再说. 

题目会给我们一个字符串, 这个字符串由三种元素组成, 分别是非负整数, 空格, `+ -  * /`这四种运算符, 它们共同组成一个合法的数学表达式, 请你求出表达式的结果.   比如对于示例一, 先算`2*2`, 得`4`, `3 + 4`得`7`.

## solution

本题属于表达式求值大类题型.   对于这种题型来说, 主流思路就是用栈进行模拟, 具体来说, 包括什么双栈模拟,  一个栈维护操作数, 另一个维护操作符, , 还有中缀表达式转换成后缀表达式,     不过由于本体较为简单, 所以我们使用的是一个用来维护操作数的栈(数组模拟)和一个操作符.

我们的最终目的, 是将原先的数学表达式转换成全为加法的表达式: 原先的减法, 被转换为加上负数, 原先乘除法, 以结果的形式出现在栈中.

比如对于`4 - 3 + 6 * 4 / 2 - 123 + 34`.

我们先把操作符初始定义为`+`, 我们首先检索出`4`这个操作数, 然后看看操作符, 我们发现这个数字前面的操作符是`+`, `+`的优先级较次, 我们不确定下一个操作符是不是更高的`* /`, 所以我们先把`4`扔进栈里.  接着我们检索出了操作符`-`,  将操作符更新为`-`, 接着我们检索出`3`, 我们看到之前的操作符是`-`, 要把减法转换为加法, 所以我们应该把`-3`扔进栈里. 接着是`+`, 更新操作符, 接着是`6`, 可以直接扔进栈里, 之后我们遇到了`*`, 更新操作符, 接着我们检索出了`4`,  再往前看, 操作符是`*`, 它的优先级是最高的, 所以要把栈顶元素取出来, 然后把它作为左操作数, 新检索出来的作为右操作数进行乘法运算, 但实际上, `stack::top(), vector::back()`返回的都是引用, 可以不取出来直接改,  好的, 现在栈顶已经变成`24`了, 接着检错出`/`, 更新, 然后检索出`2`, 往前一看, 操作符是`/`, 所以栈顶元素就变成了`12`, 之后检索出`-`, 更新操作符, `123`前面的操作符是`-`, 那就把`-123`扔进栈里, 检索出`+`, 更新操作符, `34`, 扔进去, 之后遍历完毕, 把栈里的元素都遍历一下, 连加, 最后的结果就是表达式返回值.

在上面, 我们有一个小点没说, 那就是怎么把数字检索出来, 比如对于`123`来说,   我们首先准备一个临时变量, 初始值为0, 之后, 每次检索出一个数字字符, 就先把`temp * 10`, 然后再加上转化为整型的对应数字, 比如, 首先我们检索出了`1`, 那就`temp = temp * 10 + 1`, 这样`temp`就变成了`1`, 然后检索出`2`, `temp`就变成了`12`, 然后是`123`.

好的, 让我们总结一下:   遇到操作符, 那就更新操作符, 遇到空格, 跳过, 遇到数字字符, 解析出完整的数字, 之后查看之前的操作符, 如果是加, 那就直接入栈, 如果是减, 将相反数入栈, 如果是乘除, 那就把栈顶元素修改一下,  最后把元素都累加一下即可.

## code

```cpp
class Solution {
public:
    int calculate(string s) {
        vector<int> st;
        char oper = '+';
        int idx = 0, len = s.size();
        while(idx < len)
        {
            if (s[idx] >= '0' && s[idx] <= '9')
            {
                int temp(0);
                while(idx < len && s[idx] >= '0' && s[idx] <= '9')
                    temp = temp * 10 + (s[idx++] - '0');
                if(oper == '+') st.emplace_back(temp);
                else if(oper == '-') st.emplace_back(-temp);
                else if(oper == '*') st.back() *= temp;
                else if(oper == '/') st.back() /= temp;
            }
            else if(s[idx] == ' ') ++idx;
            else oper = s[idx++];
        }

        int result(0);
        for(auto e : st)
            result += e;
        return result;
    }
};
```

# end